<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Create Alfred workflow for uploading screenshot to S3 | Tony Xu Blog</title>
    <meta name="description" content="As Markdown markup language gets more and more popular, most people have a need to quickly generate a public url for screenshot/image in clipboard. Today I created an Alfred workflow that helps you upload images/screenshot in clipboard.">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.dcae4551.css" as="style"><link rel="preload" href="/assets/js/app.d16497d1.js" as="script"><link rel="preload" href="/assets/js/8.e0a3ece0.js" as="script"><link rel="prefetch" href="/assets/js/10.3498ffb9.js"><link rel="prefetch" href="/assets/js/11.8f6bd1eb.js"><link rel="prefetch" href="/assets/js/12.3b6549ee.js"><link rel="prefetch" href="/assets/js/13.83f8516f.js"><link rel="prefetch" href="/assets/js/14.9cc9bf23.js"><link rel="prefetch" href="/assets/js/15.027b30cf.js"><link rel="prefetch" href="/assets/js/16.0662f42b.js"><link rel="prefetch" href="/assets/js/17.9aad6d60.js"><link rel="prefetch" href="/assets/js/18.60f4d9ed.js"><link rel="prefetch" href="/assets/js/19.348a8473.js"><link rel="prefetch" href="/assets/js/2.881dd6f2.js"><link rel="prefetch" href="/assets/js/20.0ac21507.js"><link rel="prefetch" href="/assets/js/21.a899d87a.js"><link rel="prefetch" href="/assets/js/22.fd57834d.js"><link rel="prefetch" href="/assets/js/23.f2dc06d5.js"><link rel="prefetch" href="/assets/js/24.9b7fe64e.js"><link rel="prefetch" href="/assets/js/25.b5829770.js"><link rel="prefetch" href="/assets/js/26.3b85cc00.js"><link rel="prefetch" href="/assets/js/27.9cc66107.js"><link rel="prefetch" href="/assets/js/28.40876834.js"><link rel="prefetch" href="/assets/js/29.60cc36ef.js"><link rel="prefetch" href="/assets/js/3.08439775.js"><link rel="prefetch" href="/assets/js/30.c2290d39.js"><link rel="prefetch" href="/assets/js/31.41af31d7.js"><link rel="prefetch" href="/assets/js/32.9f352ce6.js"><link rel="prefetch" href="/assets/js/4.3936b1d4.js"><link rel="prefetch" href="/assets/js/5.25fdfe69.js"><link rel="prefetch" href="/assets/js/6.08e3dcfa.js"><link rel="prefetch" href="/assets/js/7.90c6ca7f.js"><link rel="prefetch" href="/assets/js/9.bbb8b728.js">
    <link rel="stylesheet" href="/assets/css/0.styles.dcae4551.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Tony Xu Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">Posts</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/posts/2018/create-alfred-workflow-for-uploading-screenshot-to-s3/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/posts/2018/create-alfred-workflow-for-uploading-screenshot-to-s3/" class="nav-link">中文</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">Posts</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/posts/2018/create-alfred-workflow-for-uploading-screenshot-to-s3/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/posts/2018/create-alfred-workflow-for-uploading-screenshot-to-s3/" class="nav-link">中文</a></li></ul></div></div> <!----></nav>  <!----> </div> <div class="page"> <div class="content"><h1 id="create-alfred-workflow-for-uploading-screenshot-to-s3"><a href="#create-alfred-workflow-for-uploading-screenshot-to-s3" aria-hidden="true" class="header-anchor">#</a> Create Alfred workflow for uploading screenshot to S3</h1> <p>As Markdown markup language gets more and more popular, most people have a need to quickly generate a public url for screenshot/image in clipboard. Today I created an Alfred workflow that helps you upload images/screenshot in clipboard.</p> <h2 id="demo"><a href="#demo" aria-hidden="true" class="header-anchor">#</a> Demo</h2> <p><img src="https://s3-us-west-1.amazonaws.com/tonyxu-img/2018-07-08+21_33_30.gif" alt></p> <h2 id="overview"><a href="#overview" aria-hidden="true" class="header-anchor">#</a> Overview</h2> <ol><li>Use <code>pngpaste</code> to get image data from clipboard</li> <li>Write to a image file in <code>/tmp</code> folder</li> <li>Use <code>boto3</code> to upload image file to AWS S3</li></ol> <h2 id="implementation"><a href="#implementation" aria-hidden="true" class="header-anchor">#</a> Implementation</h2> <p>Now we have the idea to achieve the goal, let's do it in Alfred workflow and python script.</p> <h3 id="create-alfred-workflow"><a href="#create-alfred-workflow" aria-hidden="true" class="header-anchor">#</a> Create Alfred workflow</h3> <p>Create <code>Blank Workflow</code> and give it a name</p> <p>Right click in background and select <code>Inputs -&gt; Keyword</code></p> <p><img src="https://s3-us-west-1.amazonaws.com/tonyxu-img/2018_07_08_20_56_57.png" alt></p> <p>Give it a keyword which you will be typing to trigger the workflow</p> <p><img src="https://s3-us-west-1.amazonaws.com/tonyxu-img/2018_07_08_20_50_57.png" alt></p> <p>Right click in background and select <code>Actions -&gt; Run Script</code></p> <p>Let's make it use Python to run a script</p> <p><img src="https://s3-us-west-1.amazonaws.com/tonyxu-img/2018_07_08_20_58_41.png" alt></p> <p>Click on the icon on the left of <code>Cancel</code> button to open workflow folder</p> <p>Create a script file (Make sure the file name is the same as the <code>Run Script</code> action uses) and edit like below</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#!/usr/bin/python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> print_function
<span class="token keyword">import</span> datetime
<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> atexit
<span class="token keyword">import</span> imghdr
<span class="token keyword">from</span> subprocess <span class="token keyword">import</span> call
<span class="token keyword">from</span> os<span class="token punctuation">.</span>path <span class="token keyword">import</span> expanduser<span class="token punctuation">,</span> exists<span class="token punctuation">,</span> basename<span class="token punctuation">,</span> getsize
<span class="token keyword">from</span> workflow <span class="token keyword">import</span> Workflow

<span class="token keyword">def</span> <span class="token function">capture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    file_name <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y_%m_%d_%H_%M_%S.png'</span><span class="token punctuation">)</span>
    file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'/tmp'</span><span class="token punctuation">,</span> file_name<span class="token punctuation">)</span>
    atexit<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">None</span><span class="token punctuation">,</span> file_path<span class="token punctuation">)</span>
    save <span class="token operator">=</span> call<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./pngpaste'</span><span class="token punctuation">,</span> file_path<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> save <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token comment"># Quit job if no image found in clipboard</span>
        <span class="token keyword">print</span> <span class="token string">&quot;No image found in clipboard&quot;</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> file_path<span class="token punctuation">,</span> file_name

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>wf<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> boto3
    file_path<span class="token punctuation">,</span> file_name <span class="token operator">=</span> capture<span class="token punctuation">(</span><span class="token punctuation">)</span>
    bucket_name <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'bucket_name'</span><span class="token punctuation">)</span>
    s3 <span class="token operator">=</span> boto3<span class="token punctuation">.</span>client<span class="token punctuation">(</span>
        <span class="token string">'s3'</span><span class="token punctuation">,</span>
        aws_access_key_id<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'access_key'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        aws_secret_access_key<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'secret_key'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    s3<span class="token punctuation">.</span>upload_file<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> bucket_name<span class="token punctuation">,</span> file_name<span class="token punctuation">,</span> ExtraArgs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'ContentType'</span><span class="token punctuation">:</span> <span class="token string">&quot;image/png&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    output <span class="token operator">=</span> <span class="token string">&quot;%s/%s&quot;</span> <span class="token operator">%</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'bucket_uri'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file_name<span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span>output<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    wf <span class="token operator">=</span> Workflow<span class="token punctuation">(</span>libraries<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'./lib'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>wf<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>This script will return the image public url and let's copy it to clipboard and push a notification.</p> <p>Right click on the background and select <code>Outputs –&gt; Copy to Clipboard</code></p> <p><img src="https://s3-us-west-1.amazonaws.com/tonyxu-img/2018_07_08_21_06_32.png" alt></p> <p>Right click on the background and select <code>Outputs –&gt; Post Notification</code></p> <p><img src="https://s3-us-west-1.amazonaws.com/tonyxu-img/2018_07_08_21_06_54.png" alt></p> <p>Now let's connect those boxes like below:</p> <p><img src="https://s3-us-west-1.amazonaws.com/tonyxu-img/2018_07_08_21_07_52.png" alt></p> <h3 id="include-libraries"><a href="#include-libraries" aria-hidden="true" class="header-anchor">#</a> Include libraries</h3> <p>In the scripts, we used below libraries and need to be included in the workflow to make sure they can be run without issue</p> <ul><li><a href="http://alfredworkflow.readthedocs.io/en/latest/installation.html" target="_blank" rel="noopener noreferrer">Workflow<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.aws.amazon.com/cli/latest/userguide/installing.html" target="_blank" rel="noopener noreferrer">awscli<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://boto3.readthedocs.io/en/latest/guide/quickstart.html#installation" target="_blank" rel="noopener noreferrer">boto3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/jcsalterego/pngpaste" target="_blank" rel="noopener noreferrer">pngpaste<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>Install above libraries like below:</p> <div class="language- extra-class"><pre class="language-text"><code>pip install --target=/path/to/workflow Alfred-Workflow
pip install --target=/path/to/workflow/lib awscli
pip install --target=/path/to/workflow/lib boto3
brew install pngpaste
</code></pre></div><p>Please note that pngpaste is a command line tool and you should copy the binary file to <code>/path/to/workflow</code>.</p> <h3 id="add-environment-variables"><a href="#add-environment-variables" aria-hidden="true" class="header-anchor">#</a> Add environment variables</h3> <p>In the script, we used below variables that we want to make it configurable instead of hard coded:</p> <ul><li><p>access_key: S3 access key</p></li> <li><p>secret_key: S3 access secret</p></li> <li><p>bucket_name: S3 bucket name. e.g. <code>my-bucket-name</code></p></li> <li><p>bucket_uri: S3 bucket URI without trailing slash. e.g. <code>https://s3-us-west-1.amazonaws.com/my-bucket-name</code></p></li></ul> <p>Add and config above environment variables into workflow environment variables settings like below</p> <p><img src="https://s3-us-west-1.amazonaws.com/tonyxu-img/2018_07_10_20_55_19.png" alt></p> <p>Follow instructions here to create access key and secret if you don't have it already:</p> <p>https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html#Using_CreateAccessKey</p> <p>Make sure the user can read/write to S3 bucket.</p> <h2 id="complete"><a href="#complete" aria-hidden="true" class="header-anchor">#</a> Complete</h2> <p>Congratulations You made it! Give it a try!</p> <h2 id="follow-up"><a href="#follow-up" aria-hidden="true" class="header-anchor">#</a> Follow-up</h2> <p>Now you may think of adding support for the workflow to be able to upload any image from local. As you are getting familiar with Alfred workflow development, feel free to give it a try!</p> <p>Download in Github:</p> <p><a href="https://github.com/tonyxu-io/Alfred-Workflow-Upload-S3" target="_blank" rel="noopener noreferrer">tonyxu-io/Alfred-Workflow-Upload-S3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>References:</p> <ul><li><a href="http://xfyuan.github.io/2017/03/use-alfred-to-auto-upload-screenshot-to-qiniu-and-generate-the-markdown-image-url/" target="_blank" rel="noopener noreferrer">使用 Alfred workflow 上传截图到七牛并自动生成外链URL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://labmain.com/2016/04/06/A_Alfred_Workflow_upload_clipboard%27image_to_qiniu/" target="_blank" rel="noopener noreferrer">Alfred Workflow —— 上传剪贴板的图片到七牛<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.d16497d1.js" defer></script><script src="/assets/js/8.e0a3ece0.js" defer></script>
  </body>
</html>
